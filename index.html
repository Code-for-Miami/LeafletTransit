<!DOCTYPE html>
<html data-ng-app="transitApp">

	<head>
		<title>Miami-Dade Transit</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>

		<style>
			h1 {
			    color: #007AC2;
			    font-family:  Verdana, Geneva, sans-serif;
			    font-size: 32px;
			    text-align: center;
			    text-shadow: 2px 4px 3px rgba(0,0,0,0.3);
			}

			p {
				font-family:  Verdana, Geneva, sans-serif;
				color: #4F8636;
			}

			table, th, td {
			    border: 1px solid black;
			    border-collapse: collapse;
			}
			th,td {
			    padding: 15px;
			}
		</style>
	</head>

	<body >
		<h1>Miami-Dade Transit Live</h1>

		<div id="map" style="height: 480px"></div>

		<div class="tabsection"
			style="margin-left: auto; margin-right: auto; width: 50%; padding: 20px 0px 0px 0px"
			data-ng-controller="transitController">
		    <ul class="nav nav-pills nav-justified">
		        <li class="active"><a data-toggle="tab" href="#livebuses">Live Buses</a></li>
		        <li><a data-toggle="tab" href="#busroutes">Bus Routes</a></li>
						<li><a data-toggle="tab" href="#busstops">Bus Stops</a></li>
						<li><a data-toggle="tab" href="#POIs">POIs</a></li>
						<li><a data-toggle="tab" href="#trolleys">Trolleys</a></li>
		    </ul>
		    <div class="tab-content">
		        <div id="livebuses" class="tab-pane fade in active">
		            <h3>Live Buses</h3>
								Live Buses: {{buses.length}}
								<div id="busTable">
			            <table>
										<tr>
											<th>Bus ID</th>
											<th>Trip ID</th>
									    <th>Route ID</th>
											<th>Service Direction</th>
											<th>Description</th>
											<!--<th>Route Color</th>-->
											<th>Last Updated</th>
									  </tr>
									  <tr data-ng-repeat="x in buses">
											<td>{{x.BusID}}</td>
									    <td>{{x.TripID}}</td>
									    <td>{{x.RouteID}}</td>
											<td>{{x.ServiceDirection}}</td>
											<td>{{x.TripHeadsign}}</td>
									    <!--<td style="background-color: #{{x.color}}">{{x.color}}</td>-->
											<td>{{x.LocationUpdated}}</td>
										</tr>
									</table>
								</div>
		        </div>
		        <div id="busroutes" class="tab-pane fade">
		            <h3>Bus Routes</h3>
								Bus Routes: {{routes.length}}
								<div id="busroutesTable">
			            <table>
										<tr>
											<th>Route ID</th>
											<th>Route Alias</th>
									    <th>Route Description</th>
									    <th>Route Color</th>
									  </tr>
									  <tr data-ng-repeat="x in routes">
									    <td>{{x.RouteID}}</td>
											<td>{{x.RouteAliasLong}}</td>
									    <td>{{x.RouteDescription}}</td>
									    <td style="background-color: #{{x.RouteColor}}">{{x.RouteColor}}</td>
										</tr>
									</table>
								</div>
		        </div>
						<div id="busstops" class="tab-pane fade">
		            <h3>Bus Stops</h3>
								Stops: {{busStops[routeDir].length}} </br>
								Route:
								<select onchange="routeChanged(this.value)">
									<option data-ng-repeat="x in buses"
										value="{{x.RouteID}} {{x.ServiceDirection}}">{{x.RouteID}} {{x.ServiceDirection}}</option>
								</select>
								<div id="busStopTable">
			            <table>
										<tr>
											<th>Sequence</th>
											<th>Stop ID</th>
											<th>Stop Name</th>

									  </tr>
									  <tr data-ng-repeat="x in busStops[routeDir]">
											<td>{{x.Sequence}}</td>
									    <td>{{x.StopID}}</td>
											<td>{{x.StopName}}</td>
										</tr>
									</table>
								</div>
		        </div>
						<div id="POIs" class="tab-pane fade">
		            <h3>Points of Interest</h3>
								POIs: {{POIs.length}} </br>
								<div id="POIsTable">
			            <table>
										<tr>
											<th>POI ID</th>
											<th>Category</th>
									    <th>Category Name</th>
											<th>Name</th>
											<th>Address</th>
											<th>svHeading</th>
									  </tr>
									  <tr data-ng-repeat="x in POIs">
									    <td>{{x.PointID}}</td>
											<td>{{x.CategoryID}}</td>
									    <td>{{x.CategoryName}}</td>
											<td>{{x.PointName}}</td>
											<td>{{x.Address}}, {{x.City}}, {{x.State}} {{x.Zip}}</td>
											<td>{{x.svHeading}}</td>
										</tr>
									</table>
								</div>
		        </div>
						<div id="trolleys" class="tab-pane fade">
		            <h3>Trolleys</h3>
								City of Miami Trolleys: {{trolleys.length}} </br>
								<div id="trolleysTable">
			            <table>
										<tr>
											<th>Trolley ID</th>
											<th>Route ID</th>
									    <th>Receive Time</th>
									  </tr>
									  <tr data-ng-repeat="x in trolleys">
									    <td>{{x.equipmentID}}</td>
											<td>{{x.routeID}}</td>
									    <td>{{x.receiveTime}}</td>
										</tr>
									</table>
								</div>
		        </div>

		    </div>
		</div>

		<div class="bottom" style="margin-left: auto; margin-right: auto; width: 50%; padding: 20px 0px 0px 0px">
			<p>
				Data retrieved from: <a href="http://www.miamidade.gov/transit/WebServices/Buses/?BusID=">
					http://www.miamidade.gov/transit/WebServices/Buses/?BusID=</a>
				<br />
				When data is unavailable (night-time), sample data is shown.
				<br />
				Source code: <a href="https://github.com/qtrandev/LeafletTransit">
					https://github.com/qtrandev/LeafletTransit</a>
			</p>
		</div>

		<!-- All Javascript code to display the buses on the map -->
		<script src="index.js"></script>
		<!-- All Javascript code to store the XML data for the tables-->
		<script src="data.js"></script>

		<script>

		function routeChanged(rd) {
			scope.routeDir = rd;
			scope.$apply();
		}

		</script>
	</body>

</html>
